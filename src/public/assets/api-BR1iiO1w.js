(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const i="manga_auth_token";class h{constructor(){this.baseUrl="/api"}getToken(){return localStorage.getItem(i)}setToken(e){localStorage.setItem(i,e)}clearToken(){localStorage.removeItem(i)}isAuthenticated(){return!!this.getToken()}async request(e,t={}){const r=e.startsWith("/")?`${this.baseUrl}${e}`:`${this.baseUrl}/${e}`,s={"Content-Type":"application/json",...t.headers},o=this.getToken();o&&(s.Authorization=`Bearer ${o}`);try{const a=await fetch(r,{...t,headers:s});if(a.status===401)throw this.clearToken(),window.location.href="/login.html",new Error("Authentication required");const n=await a.json();if(!a.ok)throw new Error(n.error||`Request failed: ${a.status}`);return n}catch(a){throw console.error(`[API] ${t.method||"GET"} ${e}:`,a),a}}get(e){return this.request(e)}post(e,t){return this.request(e,{method:"POST",body:JSON.stringify(t)})}patch(e,t){return this.request(e,{method:"PATCH",body:JSON.stringify(t)})}put(e,t){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}delete(e){return this.request(e,{method:"DELETE"})}async login(e,t){const r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then(s=>s.json());if(r.token)return this.setToken(r.token),!0;throw new Error(r.error||"Login failed")}logout(){this.clearToken(),window.location.href="/login.html"}getBookmarks(){return this.get("/bookmarks")}getSeries(){return this.get("/series")}getBookmark(e){return this.get(`/bookmarks/${e}`)}getChapters(e,{page:t=0,limit:r=50,filter:s="all"}={}){return this.get(`/bookmarks/${e}/chapters?page=${t}&limit=${r}&filter=${s}`)}createVolume(e,t){return this.post(`/bookmarks/${e}/volumes`,{name:t})}renameVolume(e,t,r){return this.put(`/bookmarks/${e}/volumes/${t}/rename`,{name:r})}deleteVolume(e,t){return this.delete(`/bookmarks/${e}/volumes/${t}`)}setVolumeCoverFromChapter(e,t,r,s){return this.post(`/bookmarks/${e}/volumes/${t}/cover/from-chapter`,{chapterNumber:r,filename:s})}setMangaCoverFromVolume(e,t){}setMangaCoverFromChapter(e,t,r){return this.post(`/bookmarks/${e}/covers/from-chapter`,{chapterNumber:t,filename:r})}getChapterImages(e,t){return this.get(`/bookmarks/${e}/chapters/${t}/images`)}getVolumeChapters(e,t){return this.get(`/bookmarks/${e}/volumes/${t}/chapters`)}updateVolumeChapters(e,t,r){return this.post(`/bookmarks/${e}/volumes/${t}/chapters`,{chapterNumbers:r})}addBookmark(e){return this.post("/bookmarks",{url:e})}updateBookmark(e,t){return this.patch(`/bookmarks/${e}`,t)}deleteBookmark(e,t=!1){return this.delete(`/bookmarks/${e}?deleteFolder=${t}`)}lockChapter(e,t){return this.post(`/chapters/${e}/${t}/lock`)}unlockChapter(e,t){return this.post(`/chapters/${e}/${t}/unlock`)}getLockStatus(e,t){return this.get(`/chapters/${e}/${t}/lock-status`)}excludeChapter(e,t){return this.post(`/bookmarks/${e}/exclude-chapter`,{chapterNumber:t})}unexcludeChapter(e,t){return this.post(`/bookmarks/${e}/unexclude-chapter`,{chapterNumber:t})}hideVersion(e,t,r){return this.post(`/chapters/${e}/hide-version`,{chapterNumber:t,url:r})}unhideVersion(e,t,r){return this.post(`/chapters/${e}/unhide-version`,{chapterNumber:t,url:r})}getProtectedChapters(e){return this.get(`/chapters/${e}/protected`)}bulkLockChapters(e,t,r=!0){return this.post(`/chapters/${e}/bulk-lock`,{chapterNumbers:t,lock:r})}getChapterSettings(e,t){return this.get(`/chapters/${e}/${t}/settings`)}updateChapterSettings(e,t,r){return this.post(`/chapters/${e}/${t}/settings`,r)}getActions({bookmarkId:e,limit:t=50}={}){const r=new URLSearchParams;return e&&r.append("bookmarkId",e),t&&r.append("limit",t),this.get(`/admin/actions?${r}`)}undoAction(e){return this.post(`/admin/actions/${e}/undo`)}getTables(){return this.get("/admin/tables")}getTableRows(e,{page:t=0,limit:r=50}={}){return this.get(`/admin/tables/${e}?page=${t}&limit=${r}`)}getTableSchema(e){return this.get(`/admin/tables/${e}/schema`)}getQueueStatus(){return this.get("/queue/status")}getQueueTasks(){return this.get("/queue/tasks")}scanLibrary(){return this.post("/scan-local")}quickCheck(){return this.post("/check-all")}getFavorites(){return this.get("/favorites")}createFavoriteList(e){return this.post("/favorites/lists",{name:e})}deleteFavoriteList(e){return this.delete(`/favorites/lists/${encodeURIComponent(e)}`)}addFavoriteItem(e,t){return this.post(`/favorites/lists/${encodeURIComponent(e)}/items`,t)}removeFavoriteItem(e,t){return this.delete(`/favorites/lists/${encodeURIComponent(e)}/items/${t}`)}updateReadingProgress(e,t,r,s){return this.post(`/bookmarks/${e}/reading-progress`,{chapter:t,page:r,totalPages:s})}markChapterRead(e,t,r=!0){return this.post(`/bookmarks/${e}/chapters/${t}/read`,{isRead:r})}getTrophyPages(e,t){return this.get(`/trophy-pages/${e}/${t}`)}saveTrophyPages(e,t,r){return this.put(`/trophy-pages/${e}/${t}`,r)}rotatePage(e,t,r,s=90){return this.post(`/bookmarks/${e}/chapters/${t}/pages/rotate`,{filename:r,degrees:s})}swapPages(e,t,r,s){return this.post(`/bookmarks/${e}/chapters/${t}/pages/swap`,{filenameA:r,filenameB:s})}splitPage(e,t,r){return this.post(`/bookmarks/${e}/chapters/${t}/pages/split`,{filename:r})}deletePage(e,t,r){return this.delete(`/bookmarks/${e}/chapters/${t}/pages/${encodeURIComponent(r)}`)}getNextChapterPreview(e,t){return this.get(`/bookmarks/${e}/chapters/${t}/next-preview`)}}const c=new h;export{c as a};
